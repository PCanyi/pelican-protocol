package pelican

import (
	cv "github.com/glycerine/goconvey/convey"
	"io/ioutil"
	"os"
	"testing"
)

func cleanup() {
	os.Remove("./my.test.bytes.confirm")
	os.Remove("./my.test.bytes.confirm3")
	os.Remove("./my.test.bytes.confirm2.gz")
	os.Remove("./my.test.bytes")
	os.Remove("./my.test.bytes.gz")

}

func TestGzip(t *testing.T) {

	cleanup()
	defer cleanup()

	fn := "./my.test.bytes"
	fngz := "./my.test.bytes.gz"

	cv.Convey("GzipFile and UnGzip file should be inverses of each and work on gzipped files", t, func() {
		// write then read
		WriteGzippedFile(data, fngz)
		UnGzipFile(fngz, "./my.test.bytes.confirm")
		by, err := ioutil.ReadFile("./my.test.bytes.confirm")
		panicOn(err)
		cv.So(by, cv.ShouldResemble, data)

		// gzip already on disk
		ioutil.WriteFile(fn, data, 0600)
		GzipFile(fn, "./my.test.bytes.confirm2.gz")
		UnGzipFile("./my.test.bytes.confirm2.gz", "./my.test.bytes.confirm3")
		by2, err := ioutil.ReadFile("./my.test.bytes.confirm3")
		panicOn(err)
		cv.So(by2, cv.ShouldResemble, data)

		// already on disk gzipped
		by3, err := ReadGzippedFile("testdata.gz")
		panicOn(err)
		cv.So(by3, cv.ShouldResemble, data)

	})
}

var data []byte = []byte(`
ruid_v02_d3s5oTaDCAYDKmFEOLWgvyAu8dPsTacNMnlhf66csgAK4Pm4Sz8BxKKlbaWza_o0Y1TZmewyMyrvTT8YPZPwLg==
ruid_v02_bwEYO0nNCy2mZRbib_zalE9bqIHqy3R94_UjgUObLjw-GLTQRwRI_1vtmgvgBJAC_IeE1Ni0-HmBerPiJsXjZQ==
ruid_v02_kmL7jVb_WLwOlp2hU538fqYGp9dVawE8HJ8CxKOnxz_byT-RyAaGRV5B_kDHqNwBHo2hhWvfIJciNst9XfgQmw==
ruid_v02_svvJfz6wrhHlau9-hYIsGdkjmpjnZV8hXFL-W8Fwr3MI0xqKpvJc89pM_Vjq9FEVp_4wRsArb1WAOYhOO12dFw==
ruid_v02_csLyCL83f32cZQZBp2MC6y8Mx4Pgu4n21-xo9QpcCsx9j5bqqd10pjrw3ZGwclHEboQPi4bL8fcXa44PZ5SSnA==
ruid_v02_pyB04RgpBkSMGwG3dAFgj5pSi0OJjh4jkuM3LCeZdoHdbUTFtYGuf4DK1WdfEGITAnfpeQakY80fOH00m9cyxg==
ruid_v02_kTlB0xWPr4JZPyNx3W1V_ObckurKKNmm8hjRnhpPgsT2DDf3nO-nHhSjSeqNcxqtkARhIqanMZkMAP4W3TDuxg==
ruid_v02_rOY2ebz0YQy2Hy1bgBGBFthYK-KalBWRLI2aTM685NP8GmDfBpyC8XAiHuKjmKnKxPaXATP4xOOknFffPyw5DQ==
ruid_v02_MTDZrsXJwNjwCukF10pPQApbbwc4YJhFAMM8I3nHmiWCFN41NsnsFgljiuJ9XssvBRsoRYz1nuQg2YLQgfx1iQ==
ruid_v02_bY1Wxcc7IGDVGvneMIUwUHowMRiY5jZsOftrZmIPInOovUHnLEDjdSkfKXftt_vOpbNed9CxFQwx63Hph8Spew==
ruid_v02_qUyduJLKkb7z4YIjTdK-u8oGEZxXst9xpdgyCQIk2qnneCff_S8EU8OvvLDb4XMl5TAJgXj6vpY8eY-lnsgeEQ==
ruid_v02_XXI4ZI5c0Q2zTQQ3xvbC1vsKsfnbkG3a2llqcJgWsU2UhKPlvzYynKRXYk4TNQ_JUuRfxqwd2GVynLKRh9sCCQ==
ruid_v02_vWq4AX22zXjlKnJy2yL0kNkaCNxwZgBQifhGbd_Hv3lRh4UU4CPkUW8ZrL6BHOFPkah-n38pZ-J1QNxsrdeMQg==
ruid_v02_P3eUqiQNienPzRGnZTj_Hew5q9suaCAGS-J8Tm_x80phs_dTNLvr6giNHbTZc2SYKTDQ08g2RdQtkc7lqXqx-w==
ruid_v02_OLz4HPyaPi20FI8MhG9EuJkzSclbHTTKRaNqdmQVHfbEVT1vRxh2zLa6u-WKMd7FuR3IJ3pV_Um7oBMhbCTgIg==
ruid_v02_Y0NqwrsWYHbi9XRpVD4dxLnZ8fN3bTEb3tiz-oojhfH6ScVCtAOGijXI5DL3cOTATQ_Z5Yi9-cIUAKJM32eURw==
ruid_v02_Hx26IFiuxQsAu6WZemfpLA5-QVLaBNirXuaxHP6O9CV1PHNmkl-Xx0OMN_7P4aM3DQ7q6gA8pjnqKyb5GbgJ8w==
ruid_v02_chIIn0HvQKHQlB0Em4id87TbBgWzS7BZsodhb7A4MQC3Ft-nal3PZRARX0X2OWtjOv-QsvzFvCEwZhnviL_6LQ==
ruid_v02_zOy8EPSZbYrKfGJy229dPK7Cez15jrrBSHU5MWiYIWgGN9zzOxgQ8oiLmDXy2BNPRx00t1JOk1rGRfEJDyBmuQ==
ruid_v02_P0KTOv7A5wBRZ_qHvO47J_OwOhzHPBqAvXuaDcYMbXgxgGjuhL1APbuqVTWFTLp8m1zdV0kXKDrrC0nHd_Na2w==
ruid_v02_US9sKJCoVH-FZBeUX3q3iyjwy7bAjZ6t05s84fDhbLDQRH-VCCp97x6PxBQGBVIDOj-iPrFGdXoMjL_AZCJlkg==
ruid_v02_knKPwP-SDf_MAuQHiNP-60qjcZShKZ2P9fjd_ofz9enTi0h2zT11adXzREgDIFA6E3UiW-fQUjE9Hwk7l8U-vQ==
ruid_v02_Z_KoaWxcetwAoIhcY08I58I0G1X8fCL_sJpvoz0wYqU2zBJSFzxbkM5lI_ty8pCEtpIhgMJsuO2GvMv1u9Hq8g==
ruid_v02_wYwwjxKlamx6pXbxRN_1mwwEXN0XrqHpC1xif3Gvz5ZRqBuzlGSaya4GO8OUx-sJInrazfsVmp_8yA--uDYANw==
ruid_v02_wSyjcqeGqumTexYMY-oibinmDdgC_p8BSUX32sHSTEXB6VHrub6dFqGofZ3OuYqPrqxA3qG55yGi4is7dFnLqQ==
ruid_v02_1G81-n4OkGnOsf1jqL8YXRAqTADpsHApit2ooax0rbZFzXlaxKZPgNIqP-I_HpxGVO0Zqk-I2T83ZNkd_Dh3kw==
ruid_v02_a6HOxMFA6LkAcM5bO3NXFp27yNIas3ay7n-q9SyJfKMSxLadFYS7TJp6LGvTilnCXlIb4oCI2Ouwb0hXD_CMzQ==
ruid_v02_BOCxf3HHnDUrM3RUMRu2lKBFp3OmzjxmRQI3eYi1OIw8URCpGvAfOQN1V9k8ceGKg6Jk9TJn_qANykep_3uJCw==
ruid_v02_QHrgmUC7nTXRQW-kac9q1ZYz8Sk1ocsq-Rh2Q_cjVdsz8xpBdzi-nY7S2bn8Zv-CWfpNR3FhUGrO_VYrT596yQ==
ruid_v02_cOqvhlAf-aubtsLbb3U94UfdkfSg_1GpCE5m5AdednFh6SIHS5RMg4GibccIRkhkfn7seiD8DzoJFXhoJTJe6Q==
ruid_v02_Ll-AI7374ROprHPGR3um7yOCpKghdyIjKve8JPGBA-FV0gLTwBhPTl8d2Kl1HT4H1VTLqBrmWyD7Ilg7evmPlA==
ruid_v02_Jr3A8YF3X-d-t9_I1EEl4KYOlYF01ThM6XoKy1cYH71CriCceNLNKib3TxB5On7Tyez1Vkhh_Udh3fsh3GXDNw==
ruid_v02_hP0v6dt_JZWtmvHGTV_DYgoeQQu77dFLII7mndZ6VmB0YnwBqfQO59tI2mT9QA-0KboyC1WbB3y2tsRMTqjvtw==
ruid_v02_DZF7OkFIFPIgBQQd4z0m2B0xqShP7kbt0WvcpdrpLdKzdWY-ZUWwPGogpirnURxwPUDzVXZBhW30QJNNCnrNnA==
ruid_v02_Ocy4nnIgBBROviCbDqBcTeOMuII4lWDbe3QxL8njJvMjV2ydqlGY9pFkh3Btaxo6Ur-fNIXKo54N1bpLJCgD7w==
ruid_v02_1WhRpvH4-Imj78f8FBOQf11Gnn1em-UKBE9oqe1BJcHhjwa6IJz7kAsB4sV_01ZOvjY8W3ribldm7jT-VvOBtQ==
ruid_v02_qUZrkFlRr38aUFaVE8xvF35pUq1Blr_g8uNFrrliQGXqvtovzcomb-opUZLM1pD4wj6JtkL87yHjEhpfbQMwpA==
ruid_v02_WJ0yCDn77VRsAV8iPPCUqeRiOaIFZZJnxLrEJPCwPLLa9LclDlfAYSc9e5tDRDnLlI2zagyL0s7PwzmvtUxANQ==
ruid_v02_Kf6syKc_JdueyXs3F0VegeSIlykRnmOmODAa4eYZyuacy8EZv-dejo8C7fSd_Kgf-X6rsk8pTcmVzco3KWBXTw==
ruid_v02_hsxtbgPiNDo4PckqwOb0AQh81SHYiQmnqKDHlGmhAfIpfEYW-1H3m2i2z_gr_JwS2tD66NuyNRL0CnYQVLCI5Q==
ruid_v02_dXYGyvkxJfAQ59OqSUoRc9y3BkdPJVXeQWJLd_3uym8e1XOU6Wai-Xuuts83hUm6NhDtCbgRbXWfMcyxPaYMdA==
ruid_v02_Frtdvmk7Dexwl0sCCwLWTYVIQ13SKrJb9wT0-cCnITTJ08eEsIEinuDYdmAAQcrlCKe3UlPpQH38FL657tFx_w==
ruid_v02_HA6uexq8UdVp2V_eSGREkdmCZ78bXESHslXjsqPg9cMEpMCXCJuvXGat6y-00vUeKoX6Qwfy4quK9I3abFRXtA==
ruid_v02_L8w8_0iVDBFA5I19rgHNlPZrknHpaf3ueUKr3n1MlQNdH6w9woS5VSDjWz0ECpPqkk-aH2eXkd_7z8Tu_htXMg==
ruid_v02_oBFG8Zn-VhAkUGDGAXS7C8UyhbIWse3B_8J19iHhQt3-hC3qRLQFj98_MwXgZymoRWWXyppHj2R1M9azbyBJ8Q==
ruid_v02_Z9pXDofPOJF72ocR5iLQWdt08QBmL751UjjqG-tNF83Q9Row9GgqFNjJsnou_VERVr_6w0HEgKGux3UJzYALGg==
ruid_v02_Dhn3d_TzJUyJzsQzhjtE3h7F7tSKbznL7xYndyT9YGQwMe8uuPWC55WQXsxI9JyS3_pJV8iCWQlOe9QRoSMYCA==
ruid_v02_xg--3EwWNELTgAsWHlX8O4sKQmGg3BkCC__ewrE39t-KRHpXSezdnwfgjKRb-agOvQKE2cL3w29bMdH8om3yww==
ruid_v02_nYqfqRhnhlHOSv0eIn3zGTrCOiefSFBQozPdrpFJTagsfrYG_II_gxFIeeq4QyjThxT-wWI_1zR3IwyP--DzDw==
ruid_v02_r1Zmtg4_ZUP-rNfyRhUpcLlZgUbyYlKFfgDFbOrXKh3EekmoVuVQtPE3gErk2oML6hTUM8uETZG8m_tOBoKLwQ==
ruid_v02_VFMNbqUDJJ51BgV0d-mxhqGL4DueScgt2f-UFp2awTTiFykUnLUQ9UovGgKMnT0yxR4CCNmz3dyT9mPS-rteTQ==
ruid_v02_SuqjVX7PI12kVmgvOSNRxS70qpjImucfJROTpoHBBuTsQgrdWrE9uzMgJCGaTvV2KJv72Dc_3YrQU8jweQ9GEA==
ruid_v02_oLTjU1grEcYGO89GuogxLI5sf_GE1cbD0xQ3q41SefYHRfzc2-7JBrEIL9lztRbZZb5mhrzkbbmCbc1hQVsWrg==
ruid_v02_jkmWsa99flPA7B0eTyyFwiXFMhKWbshqFE-HchfLHH_LUKIGg7ggcrRYmQBqwU9ioHGVb8KAVBp2aA1npI7Q5g==
ruid_v02_U05v0mWOKnrLjm7fVL6EZw7WITxw5P-sbJ7lyr9NuY90oyhhWlrKXv-ybEe0UfblMr2qA0DSCFQjw9kRN81gzA==
ruid_v02_mVqXFICazBQI9iygWBqJRaJtXzr9rT1SThAhBmzZ_ewcvcI9SX2Ks7jLYVPMhbrFEOw-r_54Sx0355f6Ii8G3g==
ruid_v02_7I2l1CLhS37UEsm_4LyH0cw7EqHT3jdtlNtDCeuWiJ-YLZzpj03-GI_7_1yf0hsKGHerBpMYu3g2vtJWp-f0Pw==
ruid_v02_bEfO9_MNp6P-oXDLeicISMxNaqZU6MFrcr3YLBbLMvvKAj8LCB3WehMcht3vi92TG3clIZ0H_VyWRdi8PukDTg==
ruid_v02_cQp7QZDXsmh0eMUyBjQcTENUcH3qupapG85WXFgBXl1ntQ9KgtZEV3oPRXTh5AKsGvwbLEiXrQoFd6ai1Dn__Q==
ruid_v02_YcHAnmUkGWy8iXKNgxHezLToo1_4Zj-u_XXxG8xRAJG727c9ZwnQmjXETw55xa0zsHQHfJ8Pl7jXSlrhLOo3Hw==
ruid_v02_Efgrbd9OhFhjxuHV5nJWFyvClWKz9R81MwCiMnWKKYxZaZmY2bo30qz9hzzTRiDNrPT0PA4pO9TA6JtqncwcCA==
ruid_v02_-hptN_usQRLv6mYW-i_gDWhh4UaZo5JRaaX4DYQbzABqMQEl_huobra1QrgrPa9HHtuuMfFVEsx5O88jr_JXGA==
ruid_v02_5y804r801rRFjN1u3fPN0GhoRV17sOcWUyDk8PL8xQaJ21WYvzByrzfCkPJdcKGB7f8nueN8JmaCehebqVbU0Q==
ruid_v02_PHImR4K45YQjx3EkezEmkwp46yVlgqXl8-VZkkJSfABpHV4uEeJrOAuAJNif-6SlbN_cAbPwUKmxx4NhwvUWag==
ruid_v02_Ar_IQvOhQWnmfsNOA7vprM_tEdVakYqeMP4UPl5_iQ0xyqRZv0tp1Z1_Sq96uCV5KdMxXvfvghZNvionOH8o-Q==
ruid_v02_od5tDEiu9EfOOPIhICd8gF5J5wR3-zliztqOC8Rjn_Ja59KtRwIqHOYy34raHpWSR-WR4SH0Ya7oil6Attr1_A==
ruid_v02_udklSh4T3Ve7X3bAvwfZUk4LMllbWPVVxl8hg_2Hiy9He1Bz32ObxBg0UAJQe16l3rmDPiPWhR_1G3gEXqTcmg==
ruid_v02_FW0H1qDhVxgMBhXN_jz02VmDMpZDAB3JcwkeJBSUlsJO-7ksWc7a50LK8EjbWlkuVK2ZQ84xWRP2D4t713M88w==
ruid_v02_5TwqF_4z9GOzYVQypHfkPeIUR1VTNzQFjXhzRQ6YHeMfwmw8EksD3QEXLfsYWAYpEajdXVUGPA9zPgX-Hvt2Rw==
ruid_v02__5xjrahqs_C0-JZO1ZsH2AKDVzID_E3OPcrHbmCMdtbBa4N6uajQivWXyva93WHA8MN-6ItUmqGy29Al2h3LyQ==
ruid_v02_Clduk0pyvBp1krpIWRO0FXsR2pPVxe1_FD51l6OsUHC8r5Bj3Zv9hoUN6UFDEmMiAwHwSMlon2V-z88gmD0QZg==
ruid_v02_sRm2Amcg9q1L2XBybApo3DwkXF2k-ltjGq392qastYpsYsD_uowNcb_4WWgXF9VvODYs0IKcj4wH65NM6MxbyQ==
ruid_v02_p_PtDRFsyEhHFTKdQ1aakUOItL6xDUMksXrUX__KOuJPbyA4a2mEUptRxXYJp1eiisj_Pbvvbu9zUQZ28cw98w==
ruid_v02_763zsQB9f-rhlOd3DS7lbEiVJeGmXF95d3Z0Qeh_qI_z0_PCCqgoh2NnVLmcxb_5OmGGq8EvsYKD8jCxDLssCw==
ruid_v02_qVK-IbWdSW9a9BkDuLERwnOSSTtqxmBKw8zTNVpOd3EtvkHZLTenUj5FiQ8-W1xCsHI_n5h1JnUfBIW7P-bdxA==
ruid_v02_KzltpDUZjA4ZUJjZgN5HO2OOa2Ag7rTMarFGYwXq4HBxlsG-Khb45qK-eojmOBTdC9ldWglfnsFoC9aA1Z0-9A==
ruid_v02_qwC9yOCRTMQoEs7VzJ_bqMr5F8I62hrLCMWclTPZNqoDrg9oFKFtl3a1i97dajZ8otZH60saJjjvuWstIy87vg==
ruid_v02_qiAK07NRlo23-tLf_5xmsBjrbrAPHZz-4JnPqrMPRSDv6IbGqDz3q-io_6xHyZEQQ4RE33v19lx5xX9zj6oA-w==
ruid_v02_KjlCQZz_-fpAzupxidGx7I9i8kUznr_CKKxR9ibGeUye-n_AYsAI_7-84WLeLx0BqBYSShXLlxDDhVhHDApUPg==
ruid_v02_Niu5q5-CbTovpCiMtEkAgF48tygfJp89w_gI8K7C8vXbsc4o_W3NZUO4-rPXMgmFe-0DRVMpryqi2vM5erYPjA==
ruid_v02_e9_mlefnm5fW5t4vFjDV6JKgG6JbpsdrGzfY7wmVwT1PvBjPV6_NKfv9k5TJTNuuHUqNGW7y1Ez2MlBM_4jk7Q==
ruid_v02_x1mo2cYiaO3p_EYJ4DxDXaW42OLw0AACOlG0hYohc72AOb6jIgJ66zFdMb8cdm_hw2w8DqiHGjAqKbmzo8GxNw==
ruid_v02_WBzkNyFVTeftuMnUeh6E_3jrquZnljbnu5C1Dr1vXo562-XiLCwd21xDo8uKEQi_ExYNEJzjsJ06vQ0OPhJ7Iw==
ruid_v02_ZlYovu__oIlgcsuzBJkMt1W4IFpjDX8zmXkCwdnbPfs8E2J2S_BdU_k0QuPX1z1coNVEP1C3VeYyCgCUEfaWyw==
ruid_v02_zu1C4SPa1-iOha3kcIW9fqlxq3N2au0ggwnmuDL_i1IEh2l7M6oNVxeRpRo6G5HUUQvPqjQFNtZGJmej5HqP7g==
ruid_v02_bSwct3aEjE9pbuKmvZvGsNUfAwIZmCWGpGsDBGrtFvd8lburC6daJ5p_NeI8HTFKjSeRO2r0eSbjzIyJh4OmOw==
ruid_v02_W1bhGWJhIIH3xyh4eEdEzzdjvJV4sbHJ27wt46nKIaciD2pTywx3hh3Rdgxr-B4_xtYOgCYCImE30lXJ2Yy76g==
ruid_v02_aBeI2-9Qxbq-fWKRFGbZu6zWkSbzo2-91oM5sb7CpxnxyMwhvFhPCgA6ZTFqS8HXoleFfZTRn42J6KFE2hCMsw==
ruid_v02_P5kiH57REOi4BzDBsXK2wvBYABknvm0-apTobTWJJBERk1mxzbiWeORoCyrLsGRwj3HpYGadp6gAsmXjeUkGwQ==
ruid_v02_73hjVwMSo-GlvEOG3S65hIBQsdTeinJA5gBNUjrMGq0Dlb95Z-91nJm0cMZ6gcI9r-Zz_tpG9EAw29zf--U0nA==
ruid_v02_2JCL7Yuvx8Mh1ewdEtnNjBj3TZw-ItLXozIB2pqYjJBSAPdB0v79Sv-UCgUwLXXycDsxGqPcCe04HRTVA5IU8A==
ruid_v02_7cH7DWIOPxvmzJqRNByXb_xV_8rn3WlhVWWhRosLKu5Bt6Iih7vXhroHAzYXUGw8Im1TWuvp6NA-o8Pb2aUm1g==
ruid_v02_bcz1VDuJEw9MtyigGT3p42s51beRY77l-5UyQUyVDWW_N9j3M0nI26kH1HgizOFPU7sZs7bxwQ2luYETboSZ3Q==
ruid_v02_LMoM5sTI8ePL0p8pAviucTGAf9NWEgykuVvWLcpRvqQ0OgLwlgmonNU8CJ4Qllg7obhV-nK0baxZr_JkzmjfIg==
ruid_v02_mLuvcTqJxyqMNRZLl6UQH0lefJtoO_VnKrubVnvQtGi0fCKlxZuHwxClriP7pllpvhUNhCFLhtyAsC4qOforfQ==
ruid_v02_vgFKbBlKgRMVxxt8nxCr813f4HVQobrHUwINOHBYjBe54T2rSF3QXflua94ia0cI8aKoWaEGcvw7gc_KpzO90w==
ruid_v02_4iT-gYDUtdzkqV9RlLryD3y2D30cXfTGCFujHE3pNZ3AyeoYYwJd-9KMb9kzjAodCCiwWBCKDEYSy_VkudIHYA==
ruid_v02_tT1uM73iWXMAQHAaTq_rV7wScXDGNlppHmxbh1y8hN-lMR4Tf6HAu_VrNAa6s0D5ny7xIKR5Gp8p675suCS0CQ==
ruid_v02_MkcQftZ-NXcn3QuOfyOkQ12PChCTwOCtw58FEpvRlBI2xqRc-Bt5Mh2a-kAXSoMtrnDkX60_-d-ZwCZ6PEeLbw==
ruid_v02_SA9fNM_a5MBkPdxwusGrtLJwM-yzANhYbInx8a32s9wrbDcyegjMHFkrwfICh2PraMsEIQX6rI3sbDO1RLUVNg==
`)
